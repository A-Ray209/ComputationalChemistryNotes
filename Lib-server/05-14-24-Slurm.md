### 1. 安装配置 slurm

#### 1.1 安装 slrum

```
sudo -i
dnf install slurm          # node01（控制端） + node02（服务端）
```
#### 1.2 配置 munge（加密）

```
create-munge-key      # node01 生成密钥
scp -r /etc/munge/munge.key node02:/etc/munge/munge.key      # node01 发送密钥到 node02
chown munge:munge /etc/munge/munge.key                       # 设置权限 node01 + node 02
systemctl enable munge            # node01 + node 02
systemctl start munge             # node01 + node 02
```
查看加密结果

```
munge -s age | ssh node02 unmunge     # node01 加密字符串（age） node01 解密
```
![输入图片说明](img/%E5%BE%AE%E4%BF%A1%E5%9B%BE%E7%89%87_20240513174701.png)
解密成功

结束

#### 1.3 配置 slurm     



```
vim etc/slurm/slurm.conf    # slurm.conf 内容修改
```
slurm.conf 内容修改

```
ClusterName=lab-server            # 集群名称
SlurmctldHost=node01              # host 名称
MpiDefault=none                    
ProctrackType=proctrack/cgroup    # 任务处理
ReturnToService=2                 # 任务出错回到控制端时间
SlurmUser=root                    # slurm 用户
TaskPlugin=task/affinity,task/cgroup    #控制任务分配
KillWait=5                        # 杀掉任务时间
Waittime=0                        # 等待时间
SchedulerType=sched/backfill      # 任务排队：先到先得
SelectType=select/cons_tres       # 
SelectTypeParameters=CR_Core      # 按 cpu 核心数分配
AccountingStorageType=accounting_storage/none   # 用户记录
JobCompType=jobcomp/none          # 任务记录
NodeName=node01 CPUs=44 Sockets=2 CoresPerSocket=22 ThreadsPerCore=1 State=UNKNOWN      # 每台服务器信息
NodeName=node02 CPUs=44 Sockets=2 CoresPerSocket=22 ThreadsPerCore=1 State=UNKNOWN      # 每台服务器信息
# Sockets 主板 cpu 插槽数；  CoresPerSocket 每颗 cpu 核心数；  ThreadsPerCore 超线程  
PartitionName=old Nodes=node0[1-2] Default=YES MaxTime=INFINITE State=UP        # 集群信息
# PartitionName 分组名称； Nodes=node0[1-2] 当前组所含服务器； State=UP 启动当前组
```
结束

##### 1.4 运行 slurm


```
systemctl stop firewalld     # 关闭所有服务器防火墙 
```
前台试运行 slurm 查看结果

```
slurmd -D     # 运行 slurm (-D 前台显示)
```























